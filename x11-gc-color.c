/*
 * X11 Graphics Context Interface, Indexed Color Support
 *
 * Copyright (c) 2004-2020 Alexei A. Smekalkine <ikle@ikle.ru>
 *
 * SPDX-License-Identifier: BSD-2-Clause
 */

#include "x11-gc.h"

#define ARRAY_SIZE(a)  (sizeof (a) / sizeof ((a)[0]))

struct rgb {
	unsigned char r, g, b;
};

/*
 * 1. Core colors from Tango palette: black, scarlet red 2, chameleon 3,
 *    butter 3, sky blue 2, plum 2, cyan, aluminium 2.
 * 2. High-intensity (bright) variant of core colors.
 * 3. 6 × 6 × 6 RGB color cube.
 * 4. 24 shades of gray without black and bright white.
 */
static struct rgb map[256] = {
	{   0,   0,   0 },
	{ 204,   0,   0 },
	{  78, 154,   6 },
	{ 196, 160,   0 },
	{  52, 101, 164 },
	{ 117,  80, 123 },
	{   6, 152, 154 },
	{ 211, 215, 207 },
	{ 127, 127, 127 },
	{ 239,  41,  41 },
	{ 138, 226,  52 },
	{ 252, 233,  79 },
	{ 114, 159, 207 },
	{ 173, 127, 168 },
	{  52, 226, 226 },
	{ 255, 255, 255 },
	{   0,   0,   0 },
	{   0,   0,  95 },
	{   0,   0, 135 },
	{   0,   0, 175 },
	{   0,   0, 215 },
	{   0,   0, 255 },
	{   0,  95,   0 },
	{   0,  95,  95 },
	{   0,  95, 135 },
	{   0,  95, 175 },
	{   0,  95, 215 },
	{   0,  95, 255 },
	{   0, 135,   0 },
	{   0, 135,  95 },
	{   0, 135, 135 },
	{   0, 135, 175 },
	{   0, 135, 215 },
	{   0, 135, 255 },
	{   0, 175,   0 },
	{   0, 175,  95 },
	{   0, 175, 135 },
	{   0, 175, 175 },
	{   0, 175, 215 },
	{   0, 175, 255 },
	{   0, 215,   0 },
	{   0, 215,  95 },
	{   0, 215, 135 },
	{   0, 215, 175 },
	{   0, 215, 215 },
	{   0, 215, 255 },
	{   0, 255,   0 },
	{   0, 255,  95 },
	{   0, 255, 135 },
	{   0, 255, 175 },
	{   0, 255, 215 },
	{   0, 255, 255 },
	{  95,   0,   0 },
	{  95,   0,  95 },
	{  95,   0, 135 },
	{  95,   0, 175 },
	{  95,   0, 215 },
	{  95,   0, 255 },
	{  95,  95,   0 },
	{  95,  95,  95 },
	{  95,  95, 135 },
	{  95,  95, 175 },
	{  95,  95, 215 },
	{  95,  95, 255 },
	{  95, 135,   0 },
	{  95, 135,  95 },
	{  95, 135, 135 },
	{  95, 135, 175 },
	{  95, 135, 215 },
	{  95, 135, 255 },
	{  95, 175,   0 },
	{  95, 175,  95 },
	{  95, 175, 135 },
	{  95, 175, 175 },
	{  95, 175, 215 },
	{  95, 175, 255 },
	{  95, 215,   0 },
	{  95, 215,  95 },
	{  95, 215, 135 },
	{  95, 215, 175 },
	{  95, 215, 215 },
	{  95, 215, 255 },
	{  95, 255,   0 },
	{  95, 255,  95 },
	{  95, 255, 135 },
	{  95, 255, 175 },
	{  95, 255, 215 },
	{  95, 255, 255 },
	{ 135,   0,   0 },
	{ 135,   0,  95 },
	{ 135,   0, 135 },
	{ 135,   0, 175 },
	{ 135,   0, 215 },
	{ 135,   0, 255 },
	{ 135,  95,   0 },
	{ 135,  95,  95 },
	{ 135,  95, 135 },
	{ 135,  95, 175 },
	{ 135,  95, 215 },
	{ 135,  95, 255 },
	{ 135, 135,   0 },
	{ 135, 135,  95 },
	{ 135, 135, 135 },
	{ 135, 135, 175 },
	{ 135, 135, 215 },
	{ 135, 135, 255 },
	{ 135, 175,   0 },
	{ 135, 175,  95 },
	{ 135, 175, 135 },
	{ 135, 175, 175 },
	{ 135, 175, 215 },
	{ 135, 175, 255 },
	{ 135, 215,   0 },
	{ 135, 215,  95 },
	{ 135, 215, 135 },
	{ 135, 215, 175 },
	{ 135, 215, 215 },
	{ 135, 215, 255 },
	{ 135, 255,   0 },
	{ 135, 255,  95 },
	{ 135, 255, 135 },
	{ 135, 255, 175 },
	{ 135, 255, 215 },
	{ 135, 255, 255 },
	{ 175,   0,   0 },
	{ 175,   0,  95 },
	{ 175,   0, 135 },
	{ 175,   0, 175 },
	{ 175,   0, 215 },
	{ 175,   0, 255 },
	{ 175,  95,   0 },
	{ 175,  95,  95 },
	{ 175,  95, 135 },
	{ 175,  95, 175 },
	{ 175,  95, 215 },
	{ 175,  95, 255 },
	{ 175, 135,   0 },
	{ 175, 135,  95 },
	{ 175, 135, 135 },
	{ 175, 135, 175 },
	{ 175, 135, 215 },
	{ 175, 135, 255 },
	{ 175, 175,   0 },
	{ 175, 175,  95 },
	{ 175, 175, 135 },
	{ 175, 175, 175 },
	{ 175, 175, 215 },
	{ 175, 175, 255 },
	{ 175, 215,   0 },
	{ 175, 215,  95 },
	{ 175, 215, 135 },
	{ 175, 215, 175 },
	{ 175, 215, 215 },
	{ 175, 215, 255 },
	{ 175, 255,   0 },
	{ 175, 255,  95 },
	{ 175, 255, 135 },
	{ 175, 255, 175 },
	{ 175, 255, 215 },
	{ 175, 255, 255 },
	{ 215,   0,   0 },
	{ 215,   0,  95 },
	{ 215,   0, 135 },
	{ 215,   0, 175 },
	{ 215,   0, 215 },
	{ 215,   0, 255 },
	{ 215,  95,   0 },
	{ 215,  95,  95 },
	{ 215,  95, 135 },
	{ 215,  95, 175 },
	{ 215,  95, 215 },
	{ 215,  95, 255 },
	{ 215, 135,   0 },
	{ 215, 135,  95 },
	{ 215, 135, 135 },
	{ 215, 135, 175 },
	{ 215, 135, 215 },
	{ 215, 135, 255 },
	{ 215, 175,   0 },
	{ 215, 175,  95 },
	{ 215, 175, 135 },
	{ 215, 175, 175 },
	{ 215, 175, 215 },
	{ 215, 175, 255 },
	{ 215, 215,   0 },
	{ 215, 215,  95 },
	{ 215, 215, 135 },
	{ 215, 215, 175 },
	{ 215, 215, 215 },
	{ 215, 215, 255 },
	{ 215, 255,   0 },
	{ 215, 255,  95 },
	{ 215, 255, 135 },
	{ 215, 255, 175 },
	{ 215, 255, 215 },
	{ 215, 255, 255 },
	{ 255,   0,   0 },
	{ 255,   0,  95 },
	{ 255,   0, 135 },
	{ 255,   0, 175 },
	{ 255,   0, 215 },
	{ 255,   0, 255 },
	{ 255,  95,   0 },
	{ 255,  95,  95 },
	{ 255,  95, 135 },
	{ 255,  95, 175 },
	{ 255,  95, 215 },
	{ 255,  95, 255 },
	{ 255, 135,   0 },
	{ 255, 135,  95 },
	{ 255, 135, 135 },
	{ 255, 135, 175 },
	{ 255, 135, 215 },
	{ 255, 135, 255 },
	{ 255, 175,   0 },
	{ 255, 175,  95 },
	{ 255, 175, 135 },
	{ 255, 175, 175 },
	{ 255, 175, 215 },
	{ 255, 175, 255 },
	{ 255, 215,   0 },
	{ 255, 215,  95 },
	{ 255, 215, 135 },
	{ 255, 215, 175 },
	{ 255, 215, 215 },
	{ 255, 215, 255 },
	{ 255, 255,   0 },
	{ 255, 255,  95 },
	{ 255, 255, 135 },
	{ 255, 255, 175 },
	{ 255, 255, 215 },
	{ 255, 255, 255 },
	{  10,  10,  10 },
	{  20,  20,  20 },
	{  30,  30,  30 },
	{  40,  40,  40 },
	{  51,  51,  51 },
	{  61,  61,  61 },
	{  71,  71,  71 },
	{  81,  81,  81 },
	{  91,  91,  91 },
	{ 102, 102, 102 },
	{ 112, 112, 112 },
	{ 122, 122, 122 },
	{ 132, 132, 132 },
	{ 142, 142, 142 },
	{ 153, 153, 153 },
	{ 163, 163, 163 },
	{ 173, 173, 173 },
	{ 183, 183, 183 },
	{ 193, 193, 193 },
	{ 204, 204, 204 },
	{ 214, 214, 214 },
	{ 224, 224, 224 },
	{ 234, 234, 234 },
	{ 244, 244, 244 },
};

int x11_gc_set_color_index (struct x11_gc *o, int i)
{
	if (i < 0 || i >= ARRAY_SIZE (map))
		return 0;

	return x11_gc_set_color_rgba (o, map[i].r * 257u, map[i].g * 257u,
					 map[i].b * 257u, 0xffff);
}
